"use strict";var end="https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/global-temperature.json",margin={top:80,right:30,bottom:80,left:90},w=1520-margin.left-margin.right,h=630-margin.top-margin.bottom;function monthParse(t){var a=new Date(0);return a.setUTCMonth(t),d3.timeFormat("%B")(a)}var tooltip=d3.select("body").append("div").attr("id","tooltip").style("opacity",0),svgContainer=d3.select("body").append("svg").attr("class","chart").attr("width",w+margin.left+margin.right).attr("height",h+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");function handleMouseOver(t,a){console.log(t.month),tooltip.transition().duration(200).style("opacity",.8),tooltip.html(monthParse(t.month)+" - "+t.year+"<br/>"+(8.66+t.variance).toFixed(2)+"℃<br/>"+t.variance).attr("data-year",t.year).style("left",d3.event.pageX+15+"px").style("top",d3.event.pageY-5+"px")}function handleMouseOut(t){tooltip.transition().duration(200).style("opacity",0)}d3.json(end).then(function(t){var a=t.baseTemperature,e=t.monthlyVariance,s=t.baseTemperature+d3.min(e,function(t){return t.variance}),d=t.baseTemperature+d3.max(e,function(t){return t.variance}),r=d3.scaleThreshold().domain(function(t,a,e){for(var r=[],n=(d-s)/12,o=s,i=1;i<12;i++)r.push(o+i*n);return r}()).range(d3.schemeRdYlBu[11].reverse()),n=d3.scaleLinear().domain([d3.min(e,function(t){return t.year}),d3.max(e,function(t){return t.year})]).range([0,w]),o=d3.scaleBand().domain([1,2,3,4,5,6,7,8,9,10,11,12]).rangeRound([0,h]),i=d3.axisBottom(n).tickFormat(d3.format("d")),l=d3.axisLeft(o).tickFormat(function(t){return monthParse(t)});svgContainer.append("g").attr("class","x axis").attr("id","x-axis").attr("transform","translate(0,"+h+")").call(i).append("text").text("Year").attr("class","x-axis-label").attr("x",w/2).attr("y",10).style("text-anchor","end"),svgContainer.append("g").attr("class","y axis").attr("id","y-axis").call(l),svgContainer.append("g").attr("class","map").attr("transform","translate(2,0)").selectAll("rect").data(e).enter().append("rect").attr("class","cell").attr("data-month",function(t){return t.month}).attr("data-temp",function(t){return t.variance}).attr("data-year",function(t){return t.year}).attr("x",function(t){return n(t.year)}).attr("y",function(t){return o(t.month)}).attr("width",w/262).attr("height",h/12).style("fill",function(t){return r(a+t.variance)}).on("mouseover",handleMouseOver).on("mouseout",handleMouseOut),svgContainer.append("text").attr("id","title").attr("x",w/2).attr("y",-margin.top/2).attr("text-anchor","middle").style("font-size","2rem").text("Monthly Global Land-Surface Temperature"),svgContainer.append("text").attr("x",w/2).attr("y",-margin.top/2+25).attr("id","description").attr("text-anchor","middle").style("font-size","1rem").text(d3.min(e,function(t){return t.year})+" - "+d3.max(e,function(t){return t.year})+": base temperature "+a+"℃");var c=d3.scaleQuantile().domain(function(t,a,e){for(var r=[],n=(d-s)/11,o=s,i=1;i<11;i++)r.push(o+i*n);return r}()).range([0,30,60,90,120,150,180,210,240,270]),m=d3.axisBottom(c).ticks(10).tickFormat(d3.format(".1f")),u=svgContainer.append("g").attr("id","legend").attr("transform","translate(5,500)");u.selectAll("rect").data(r.domain()).enter().append("rect").attr("x",function(t,a){return 0+30*a}).attr("width",30).attr("height",30).style("fill",function(t,a){return d3.schemeRdYlBu[11][a]}).style("stroke","black"),u.append("g").attr("class","y axis").attr("id","y-axis").attr("padding",30).call(m)}).catch(function(t){alert(t)});
